!function(){"use strict";const e={GA4_MEASUREMENT_ID:"G-XXXXXXXXXX",DEBUG:!1,SCROLL_THRESHOLDS:[25,50,75,90,100],TIME_INTERVALS:[10,30,60,120,300],COMMISSION_RATES:{laptops:.02,smartphones:.015,audio:.03,gaming:.025}},t={initialized:!1,consentGiven:!1,sessionStart:Date.now(),pageLoadTime:Date.now(),scrollDepthTracked:new Set,timeIntervalsTracked:new Set,lastActivity:Date.now(),engagementScore:0};function n(){if(t.initialized)return void m("Google Analytics already initialized");m("Initializing Google Analytics 4...");const n=document.createElement("script");function o(){dataLayer.push(arguments)}n.async=!0,n.src=`https://www.googletagmanager.com/gtag/js?id=${e.GA4_MEASUREMENT_ID}`,document.head.appendChild(n),window.dataLayer=window.dataLayer||[],window.gtag=o,o("js",new Date),o("config",e.GA4_MEASUREMENT_ID,{anonymize_ip:!0,cookie_flags:"SameSite=None;Secure",send_page_view:!0,allow_google_signals:!0,allow_ad_personalization_signals:!1,page_location:window.location.href,page_title:document.title}),t.initialized=!0,m("Google Analytics 4 initialized successfully"),function(){let n=!1;function o(){const o=window.pageYOffset||document.documentElement.scrollTop,a=document.documentElement.scrollHeight-document.documentElement.clientHeight,c=Math.floor(o/a*100);e.SCROLL_THRESHOLDS.forEach(e=>{c>=e&&!t.scrollDepthTracked.has(e)&&(t.scrollDepthTracked.add(e),i("scroll_depth",{percent:e,page:window.location.pathname}))}),n=!1}window.addEventListener("scroll",function(){n||(window.requestAnimationFrame(o),n=!0)},{passive:!0})}(),e.TIME_INTERVALS.forEach(e=>{setTimeout(()=>{t.timeIntervalsTracked.has(e)||(t.timeIntervalsTracked.add(e),i("time_on_page",{seconds:e,page:window.location.pathname,engaged:r()}))},1e3*e)}),document.addEventListener("click",function(e){const t=e.target.closest("a");if(!t)return;const n=t.getAttribute("href");n&&n.startsWith("http")&&!n.includes(window.location.hostname)&&i("click_outbound",{link_url:n,link_text:t.textContent.trim().substring(0,100),link_domain:new URL(n).hostname})},{passive:!0}),window.addEventListener("error",function(e){i("javascript_error",{error_message:e.message,error_filename:e.filename,error_line:e.lineno,error_column:e.colno})}),window.addEventListener("unhandledrejection",function(e){i("promise_rejection",{error_message:e.reason?e.reason.toString():"Unknown error"})}),function(){const e=new URLSearchParams(window.location.search),t={};["utm_source","utm_medium","utm_campaign","utm_term","utm_content"].forEach(n=>{e.has(n)&&(t[n]=e.get(n))}),Object.keys(t).length>0&&(i("campaign_visit",t),sessionStorage.setItem("utm_params",JSON.stringify(t)))}(),window.performance&&window.performance.timing&&window.addEventListener("load",function(){setTimeout(function(){const e=performance.timing;i("page_performance",{page_load_time:e.loadEventEnd-e.navigationStart,dom_ready_time:e.domContentLoadedEventEnd-e.navigationStart,server_response_time:e.responseEnd-e.requestStart,dns_time:e.domainLookupEnd-e.domainLookupStart,tcp_time:e.connectEnd-e.connectStart})},0)}),m("All tracking features initialized")}function o(){m("Disabling Google Analytics 4..."),window[`ga-disable-${e.GA4_MEASUREMENT_ID}`]=!0,function(){const e=["_ga","_gat","_gid","_gac_gb"],t=window.location.hostname,n=[t,`.${t}`,t.replace("www.","")];e.forEach(e=>{n.forEach(t=>{document.cookie=`${e}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=${t}`,document.cookie=`${e}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`})})}()}function i(e,n={}){if(!window.gtag||!t.consentGiven)return void m("Analytics not ready or consent not given. Event not tracked:",e);const o={...n,timestamp:Date.now(),session_duration:Math.floor((Date.now()-t.sessionStart)/1e3),engagement_score:t.engagementScore};gtag("event",e,o),m("GA4 Event tracked:",e,o),function(e){const n={page_view:1,select_item:10,affiliate_click:15,add_to_wishlist:8,search:5,filter_applied:3,sign_up:20,scroll_depth:2,time_on_page:3,share:12};t.engagementScore+=n[e]||1}(e)}function a(e){return{item_id:e.asin||e.id||"unknown",item_name:e.name||"Unknown Product",item_brand:e.brand||"Unknown",item_category:e.category||"Unknown",price:c(e.basePrice,e.discount),discount:e.discount||0,quantity:1}}function c(e,t){return e?t?e*(1-t/100):e:0}function r(){return Date.now()-t.lastActivity<3e4}function s(){t.lastActivity=Date.now()}function d(){i("session_end",{session_duration:Math.floor((Date.now()-t.sessionStart)/1e3),engagement_score:t.engagementScore,pages_viewed:1,max_scroll:Math.max(...t.scrollDepthTracked,0)})}function l(e){return{landing:1,browse_products:2,view_product:3,click_affiliate:4,add_favorite:5,newsletter_signup:6}[e]||0}function u(){const e=document.cookie.split("; ").find(e=>e.startsWith("cookie_consent="));if(e)try{const i=JSON.parse(decodeURIComponent(e.split("=")[1]));i.preferences&&i.preferences.analytics?(m("Analytics cookies accepted. Initializing GA4..."),t.consentGiven=!0,n()):(m("Analytics cookies not accepted. GA4 will not load."),o())}catch(e){console.error("Error parsing cookie consent:",e)}else m("No cookie consent found. Waiting for user consent...")}function m(...t){e.DEBUG&&console.log("[Analytics]",...t)}["mousedown","mousemove","keypress","scroll","touchstart"].forEach(e=>{document.addEventListener(e,s,{passive:!0})}),window.addEventListener("beforeunload",d),window.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&d()}),window.addEventListener("cookieConsentUpdated",function(e){e.detail.analytics?(m("Analytics cookies accepted via consent update. Initializing GA4..."),t.consentGiven=!0,n()):(m("Analytics cookies rejected via consent update. Disabling GA4..."),t.consentGiven=!1,o())}),window.Analytics={track:i,trackPageView:function(e,n){window.gtag&&t.consentGiven&&(gtag("event","page_view",{page_title:e||document.title,page_path:n||window.location.pathname,page_location:window.location.href}),m("Page view tracked:",e,n),t.pageLoadTime=Date.now(),t.scrollDepthTracked.clear(),t.timeIntervalsTracked.clear())},init:n,disable:o,trackProductView:function(e){i("view_item",{currency:"USD",value:c(e.basePrice,e.discount),items:[a(e)]})},trackProductClick:function(t,n="unknown"){const o=c(t.basePrice,t.discount),r=function(t,n){const o=t.category||"laptops",i=e.COMMISSION_RATES[o]||.02;return(n*i).toFixed(2)}(t,o);i("select_item",{item_list_name:"Product Grid",currency:"USD",value:o,items:[a(t)],retailer:n,estimated_commission:r,discount_percentage:t.discount,asin:t.asin||"unknown"}),i("affiliate_click",{product_name:t.name,product_category:t.category,retailer:n,price:o,estimated_revenue:r})},trackAddToWishlist:function(e){i("add_to_wishlist",{currency:"USD",value:c(e.basePrice,e.discount),items:[a(e)]})},trackRemoveFromWishlist:function(e){i("remove_from_wishlist",{currency:"USD",value:c(e.basePrice,e.discount),items:[a(e)]})},trackSearch:function(e,t=0){i("search",{search_term:e,results_count:t})},trackFilter:function(e,t){i("filter_applied",{filter_type:e,filter_value:t})},trackNewsletterSignup:function(e,t="footer"){i("sign_up",{method:"newsletter",source:t,success:!0}),i("generate_lead",{lead_type:"newsletter",value:5})},trackNotificationSignup:function(e,t){i("notification_signup",{product_id:e,product_name:t})},trackSocialShare:function(e,t){i("share",{method:e,content_type:t.type||"product",item_id:t.id||"unknown"})},trackFunnelStep:function(e,t={}){i("funnel_step",{funnel_name:"product_discovery",step_name:e,step_number:l(e),...t})},getUTMParams:function(){try{return JSON.parse(sessionStorage.getItem("utm_params"))||{}}catch{return{}}},getEngagementScore:()=>t.engagementScore,getSessionDuration:()=>Math.floor((Date.now()-t.sessionStart)/1e3),config:e},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",u):u(),m("Enhanced Analytics module loaded. Waiting for consent...")}();